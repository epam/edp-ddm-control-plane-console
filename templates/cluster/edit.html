{{ define "cluster/edit.html" }}
    {{template "header" .}}
    <div class="registry registry-create" id="registry-form">
        <div class="registry-header">
            <a href="{{ .BasePath }}/admin/cluster/management" class="registry-add">
                <img alt="add registry" src="{{ .BasePath }}/static/img/action-back.png" />
                <span>НАЗАД</span>
            </a>
        </div>
        <h1>Адміністратори платформи</h1>
        <br />
        <form id="platform-admin" class="registry-create-form" method="post" action="/admin/cluster/admins">
            <div class="rc-form-group">
                <label for="admins">Адміністратори</label>
                <input type="hidden" id="admins" name="admins" v-model="adminsValue"
                       :admins="loadAdmins('{{ .admins }}')" />

                <div class="advanced-admins">
                    <div v-cloak v-for="adm in admins" class="child-admin">
                        [[ adm.email ]]
                        <a @click="deleteAdmin" :email="adm.email" href="#">
                            <img src="/static/img/action-delete.png" />
                        </a>
                    </div>
                    <button type="button" @click="showAdminForm">+</button>
                </div>
                <span>
                    {{range $key, $val := .errorsMap.Admins}}
                        {{ $val.Error | i18n }}
                    {{end}}
                </span>
            </div>


            <div class="rc-form-group">
                <button type="submit" name="submit">Підтвердити</button>
            </div>
        </form>

        <h1>Налаштування резервного копіювання</h1>
        <br />
        <form id="cluster-form" class="registry-create-form" method="post" action="">
            {{ if .error }}
                <div class="rc-global-error">{{.error}}</div>
            {{ end }}
            <input type="hidden" name="_xsrf" value="{{ .xsrfdata }}" />
            <div class="rc-form-group {{ if .errorsMap.StorageLocation }}error{{end}}">
                <label for="storage-location">Місце зберігання бекапу</label>
                <input type="text" id="storage-location" name="storage-location"
                       value="{{.backupConf.StorageLocation}}" required />
                <span>
                    {{range $key, $val := .errorsMap.StorageLocation}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.StorageType }}error{{end}}">
                <label for="storage-type">Тип сховища для бекапу</label>
                <input type="text" id="storage-type" name="storage-type"
                       value="{{.backupConf.StorageType}}" required />
                <span>
                    {{range $key, $val := .errorsMap.StorageType}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.StorageCredentialsKey }}error{{end}}">
                <label for="storage-credentials-key">Логін</label>
                <input type="text" id="storage-credentials-key" name="storage-credentials-key"
                       value="{{.backupConf.StorageCredentialsKey}}" required />
                <span>
                    {{range $key, $val := .errorsMap.StorageCredentialsKey}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.StorageCredentialsSecret }}error{{end}}">
                <label for="storage-credentials-secret">Пароль</label>
                <input type="password" id="storage-credentials-secret" name="storage-credentials-secret"
                       value="{{.backupConf.StorageCredentialsSecret}}" required />
                <span>
                    {{range $key, $val := .errorsMap.StorageCredentialsSecret}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group">
                <button type="submit" name="submit">Підтвердити</button>
            </div>
        </form>
        <h1>Розклад резервного копіювання</h1>
        <br />
        <form id="backup-schedule-form" class="registry-create-form" method="post" action="/admin/cluster/backup-schedule">
            <h3>Nexus</h3>
            <div class="rc-form-group {{ if .errorsMap.NexusSchedule }}error{{end}}">
                <label for="nexus-schedule">Розклад</label>
                <input type="text" name="nexus-schedule" id="nexus-schedule" placeholder="0 10 * * *"
                       value="{{.backupSchedule.NexusSchedule}}"  />
                <span>
                    {{range $key, $val := .errorsMap.NexusSchedule}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.NexusExpiresInDays }}error{{end}}">
                <label for="nexus-expires-in-days">Час зберігання в днях</label>
                <input type="text" id="nexus-expires-in-days" name="nexus-expires-in-days" placeholder="5"
                       value="{{.backupSchedule.NexusExpiresInDays}}"  />
                <span>
                    {{range $key, $val := .errorsMap.NexusExpiresInDays}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>

            <h3>Control Plane</h3>
            <div class="rc-form-group {{ if .errorsMap.ControlPlaneSchedule }}error{{end}}">
                <label for="control-plane-schedule">Розклад</label>
                <input type="text" name="control-plane-schedule" id="control-plane-schedule" placeholder="0 10 * * *"
                       value="{{.backupSchedule.ControlPlaneSchedule}}"  />
                <span>
                    {{range $key, $val := .errorsMap.ControlPlaneSchedule}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.ControlPlaneExpiresInDays }}error{{end}}">
                <label for="control-plane-expires-in-days">Час зберігання в днях</label>
                <input type="text" id="control-plane-expires-in-days" name="control-plane-expires-in-days"
                       placeholder="5" value="{{.backupSchedule.ControlPlaneExpiresInDays}}"  />
                <span>
                    {{range $key, $val := .errorsMap.ControlPlaneExpiresInDays}}
                        {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>

            <h3>User Management</h3>
            <div class="rc-form-group {{ if .errorsMap.UserManagementSchedule }}error{{end}}">
                <label for="user-management-schedule">Розклад</label>
                <input type="text" name="user-management-schedule" id="user-management-schedule" placeholder="0 10 * * *"
                       value="{{.backupSchedule.UserManagementSchedule}}" />
                <span>
                    {{range $key, $val := .errorsMap.UserManagementSchedule}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.UserManagementExpiresInDays }}error{{end}}">
                <label for="user-management-expires-in-days">Час зберігання в днях</label>
                <input type="text" id="user-management-expires-in-days" name="user-management-expires-in-days"
                       placeholder="5" value="{{.backupSchedule.UserManagementExpiresInDays}}"  />
                <span>
                    {{range $key, $val := .errorsMap.UserManagementExpiresInDays}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>

            <h3>Monitoring</h3>
            <div class="rc-form-group {{ if .errorsMap.MonitoringSchedule }}error{{end}}">
                <label for="monitoring-schedule">Розклад</label>
                <input type="text" name="monitoring-schedule" id="monitoring-schedule" placeholder="0 10 * * *"
                       value="{{.backupSchedule.MonitoringSchedule}}"  />
                <span>
                    {{range $key, $val := .errorsMap.MonitoringSchedule}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group {{ if .errorsMap.MonitoringExpiresInDays }}error{{end}}">
                <label for="monitoring-expires-in-days">Час зберігання в днях</label>
                <input type="text" id="monitoring-expires-in-days" name="monitoring-expires-in-days"
                       placeholder="5" value="{{.backupSchedule.MonitoringExpiresInDays}}"  />
                <span>
                    {{range $key, $val := .errorsMap.MonitoringExpiresInDays}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>

            <div class="rc-form-group">
                <button type="submit" name="submit">Підтвердити</button>
            </div>
        </form>
        {{if .hasUpdate}}
        <h1>Оновлення платформи</h1>
        <br />
        <form id="cluster-update-form" class="registry-create-form" method="post" action="/admin/cluster/upgrade">
            <div class="rc-form-group {{ if .errorsMap.Branch }}error{{end}}">
                <label for="branch">Оновити платформу</label>
                <select id="branch" name="branch" required>
                    <option></option>
                    {{range $key, $val := .updateBranches}}
                        <option>{{$val}}</option>
                    {{end}}
                </select>

                <span>
                    {{range $key, $val := .errorsMap.Branch}}
                         {{i18n $val.Tag}}
                    {{end}}
                </span>
            </div>
            <div class="rc-form-group">
                <button type="submit" name="submit">Підтвердити</button>
            </div>
        </form>
        {{end}}

        {{template "cluster-cidr-block" .}}

        {{template "admin-block" .}}
        {{template "cidr-form" .}}
    </div>
    {{template  "scripts" .}}
    <script src="{{ .BasePath }}/static/js/mustache.js"></script>
    <script type="text/javascript" src="{{ .BasePath }}/static/js/administrators.js"></script>
    <script id="ini-template" type="x-tmpl-mustache">
        {{ .hwINITemplateContent }}
    </script>
    <script id="allowed-keys-template" type="x-tmpl-mustache">
        <div class="allowed-keys-row">
            <input name="allowed-keys-issuer[]" class="allowed-keys-input allowed-keys-issuer" required aria-label="key issuer" placeholder="Емітент ключа" type="text" />
            <input name="allowed-keys-serial[]" class="allowed-keys-input allowed-keys-serial" required aria-label="key serial" placeholder="Серійний номер ключа" type="text" />
            <button class="allowed-keys-remove-btn">-</button>
        </div>
    </script>
    <script type="text/javascript">
        $(function (){
            $("input").on('change invalid', function(){
                let input = $(this).get(0);
                input.setCustomValidity('');
                if (!input.validity.valid) {
                    input.scrollIntoView();
                    input.setCustomValidity('Не може бути порожнім');
                }
            });
        });
    </script>
    {{template "footer" .}}
{{ end }}